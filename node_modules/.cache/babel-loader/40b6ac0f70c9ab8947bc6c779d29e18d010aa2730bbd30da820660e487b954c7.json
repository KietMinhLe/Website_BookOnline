{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useCallback } from 'react';\nimport { Cart } from '../models';\nexport const useCartController = () => {\n  _s();\n  const [cart, setCart] = useState(new Cart());\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n\n  // Load cart from localStorage khi component mount\n  useEffect(() => {\n    const savedCart = localStorage.getItem('cart');\n    if (savedCart) {\n      try {\n        const cartData = JSON.parse(savedCart);\n        setCart(Cart.fromJSON(cartData));\n      } catch (err) {\n        console.error('Error loading cart from localStorage:', err);\n        localStorage.removeItem('cart');\n      }\n    }\n  }, []);\n\n  // Save cart to localStorage khi cart thay đổi\n  useEffect(() => {\n    localStorage.setItem('cart', JSON.stringify(cart.toJSON()));\n  }, [cart]);\n\n  // Thêm sách vào giỏ hàng\n  const addToCart = useCallback((book, quantity = 1) => {\n    setLoading(true);\n    setError(null);\n    try {\n      const newCart = new Cart();\n      newCart.items = [...cart.items];\n      newCart.total = cart.total;\n      newCart.updatedAt = cart.updatedAt;\n      newCart.addItem(book, quantity);\n      setCart(newCart);\n      return true;\n    } catch (err) {\n      setError(err.message);\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  }, [cart]);\n\n  // Xóa sách khỏi giỏ hàng\n  const removeFromCart = useCallback(bookId => {\n    setLoading(true);\n    setError(null);\n    try {\n      const newCart = new Cart();\n      newCart.items = [...cart.items];\n      newCart.total = cart.total;\n      newCart.updatedAt = cart.updatedAt;\n      newCart.removeItem(bookId);\n      setCart(newCart);\n      return true;\n    } catch (err) {\n      setError(err.message);\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  }, [cart]);\n\n  // Cập nhật số lượng sách trong giỏ hàng\n  const updateQuantity = useCallback((bookId, quantity) => {\n    setLoading(true);\n    setError(null);\n    try {\n      const newCart = new Cart();\n      newCart.items = [...cart.items];\n      newCart.total = cart.total;\n      newCart.updatedAt = cart.updatedAt;\n      newCart.updateQuantity(bookId, quantity);\n      setCart(newCart);\n      return true;\n    } catch (err) {\n      setError(err.message);\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  }, [cart]);\n\n  // Xóa tất cả sách khỏi giỏ hàng\n  const clearCart = useCallback(() => {\n    setLoading(true);\n    setError(null);\n    try {\n      const newCart = new Cart();\n      setCart(newCart);\n      localStorage.removeItem('cart');\n      return true;\n    } catch (err) {\n      setError(err.message);\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  // Kiểm tra sách có trong giỏ hàng không\n  const isInCart = useCallback(bookId => {\n    return cart.items.some(item => item.book.id === bookId);\n  }, [cart.items]);\n\n  // Lấy số lượng sách trong giỏ hàng\n  const getQuantity = useCallback(bookId => {\n    const item = cart.items.find(item => item.book.id === bookId);\n    return item ? item.quantity : 0;\n  }, [cart.items]);\n\n  // Tính tổng tiền với thuế và phí ship\n  const calculateTotalWithTaxAndShipping = useCallback((taxRate = 0.1, shippingFee = 30000) => {\n    const subtotal = cart.total;\n    const tax = subtotal * taxRate;\n    const total = subtotal + tax + shippingFee;\n    return {\n      subtotal,\n      tax,\n      shippingFee,\n      total\n    };\n  }, [cart.total]);\n\n  // Validate giỏ hàng trước khi checkout\n  const validateCart = useCallback(() => {\n    const errors = [];\n    if (cart.isEmpty()) {\n      errors.push('Giỏ hàng trống');\n    }\n    cart.items.forEach(item => {\n      if (!item.book.isInStock()) {\n        errors.push(`Sách \"${item.book.title}\" đã hết hàng`);\n      }\n      if (item.quantity > item.book.stock) {\n        errors.push(`Số lượng sách \"${item.book.title}\" vượt quá số lượng có sẵn`);\n      }\n    });\n    return {\n      isValid: errors.length === 0,\n      errors\n    };\n  }, [cart]);\n\n  // Clear error\n  const clearError = useCallback(() => {\n    setError(null);\n  }, []);\n  return {\n    // State\n    cart,\n    loading,\n    error,\n    // Actions\n    addToCart,\n    removeFromCart,\n    updateQuantity,\n    clearCart,\n    isInCart,\n    getQuantity,\n    calculateTotalWithTaxAndShipping,\n    validateCart,\n    clearError\n  };\n};\n_s(useCartController, \"ltqAItHcagzDlaoIDYD8F26QjyI=\");","map":{"version":3,"names":["useState","useEffect","useCallback","Cart","useCartController","_s","cart","setCart","loading","setLoading","error","setError","savedCart","localStorage","getItem","cartData","JSON","parse","fromJSON","err","console","removeItem","setItem","stringify","toJSON","addToCart","book","quantity","newCart","items","total","updatedAt","addItem","message","removeFromCart","bookId","updateQuantity","clearCart","isInCart","some","item","id","getQuantity","find","calculateTotalWithTaxAndShipping","taxRate","shippingFee","subtotal","tax","validateCart","errors","isEmpty","push","forEach","isInStock","title","stock","isValid","length","clearError"],"sources":["D:/frontend/src/controllers/CartController.js"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport { Cart } from '../models';\r\n\r\nexport const useCartController = () => {\r\n  const [cart, setCart] = useState(new Cart());\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  // Load cart from localStorage khi component mount\r\n  useEffect(() => {\r\n    const savedCart = localStorage.getItem('cart');\r\n    if (savedCart) {\r\n      try {\r\n        const cartData = JSON.parse(savedCart);\r\n        setCart(Cart.fromJSON(cartData));\r\n      } catch (err) {\r\n        console.error('Error loading cart from localStorage:', err);\r\n        localStorage.removeItem('cart');\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Save cart to localStorage khi cart thay đổi\r\n  useEffect(() => {\r\n    localStorage.setItem('cart', JSON.stringify(cart.toJSON()));\r\n  }, [cart]);\r\n\r\n  // Thêm sách vào giỏ hàng\r\n  const addToCart = useCallback((book, quantity = 1) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const newCart = new Cart();\r\n      newCart.items = [...cart.items];\r\n      newCart.total = cart.total;\r\n      newCart.updatedAt = cart.updatedAt;\r\n      \r\n      newCart.addItem(book, quantity);\r\n      setCart(newCart);\r\n      return true;\r\n    } catch (err) {\r\n      setError(err.message);\r\n      return false;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [cart]);\r\n\r\n  // Xóa sách khỏi giỏ hàng\r\n  const removeFromCart = useCallback((bookId) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const newCart = new Cart();\r\n      newCart.items = [...cart.items];\r\n      newCart.total = cart.total;\r\n      newCart.updatedAt = cart.updatedAt;\r\n      \r\n      newCart.removeItem(bookId);\r\n      setCart(newCart);\r\n      return true;\r\n    } catch (err) {\r\n      setError(err.message);\r\n      return false;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [cart]);\r\n\r\n  // Cập nhật số lượng sách trong giỏ hàng\r\n  const updateQuantity = useCallback((bookId, quantity) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const newCart = new Cart();\r\n      newCart.items = [...cart.items];\r\n      newCart.total = cart.total;\r\n      newCart.updatedAt = cart.updatedAt;\r\n      \r\n      newCart.updateQuantity(bookId, quantity);\r\n      setCart(newCart);\r\n      return true;\r\n    } catch (err) {\r\n      setError(err.message);\r\n      return false;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [cart]);\r\n\r\n  // Xóa tất cả sách khỏi giỏ hàng\r\n  const clearCart = useCallback(() => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const newCart = new Cart();\r\n      setCart(newCart);\r\n      localStorage.removeItem('cart');\r\n      return true;\r\n    } catch (err) {\r\n      setError(err.message);\r\n      return false;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // Kiểm tra sách có trong giỏ hàng không\r\n  const isInCart = useCallback((bookId) => {\r\n    return cart.items.some(item => item.book.id === bookId);\r\n  }, [cart.items]);\r\n\r\n  // Lấy số lượng sách trong giỏ hàng\r\n  const getQuantity = useCallback((bookId) => {\r\n    const item = cart.items.find(item => item.book.id === bookId);\r\n    return item ? item.quantity : 0;\r\n  }, [cart.items]);\r\n\r\n  // Tính tổng tiền với thuế và phí ship\r\n  const calculateTotalWithTaxAndShipping = useCallback((taxRate = 0.1, shippingFee = 30000) => {\r\n    const subtotal = cart.total;\r\n    const tax = subtotal * taxRate;\r\n    const total = subtotal + tax + shippingFee;\r\n    \r\n    return {\r\n      subtotal,\r\n      tax,\r\n      shippingFee,\r\n      total\r\n    };\r\n  }, [cart.total]);\r\n\r\n  // Validate giỏ hàng trước khi checkout\r\n  const validateCart = useCallback(() => {\r\n    const errors = [];\r\n    \r\n    if (cart.isEmpty()) {\r\n      errors.push('Giỏ hàng trống');\r\n    }\r\n    \r\n    cart.items.forEach(item => {\r\n      if (!item.book.isInStock()) {\r\n        errors.push(`Sách \"${item.book.title}\" đã hết hàng`);\r\n      }\r\n      if (item.quantity > item.book.stock) {\r\n        errors.push(`Số lượng sách \"${item.book.title}\" vượt quá số lượng có sẵn`);\r\n      }\r\n    });\r\n    \r\n    return {\r\n      isValid: errors.length === 0,\r\n      errors\r\n    };\r\n  }, [cart]);\r\n\r\n  // Clear error\r\n  const clearError = useCallback(() => {\r\n    setError(null);\r\n  }, []);\r\n\r\n  return {\r\n    // State\r\n    cart,\r\n    loading,\r\n    error,\r\n    \r\n    // Actions\r\n    addToCart,\r\n    removeFromCart,\r\n    updateQuantity,\r\n    clearCart,\r\n    isInCart,\r\n    getQuantity,\r\n    calculateTotalWithTaxAndShipping,\r\n    validateCart,\r\n    clearError\r\n  };\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}